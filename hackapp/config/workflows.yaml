# HackApp Workflow Configurations
# Add new workflows here without changing any code

workflows:
  - workflow_id: voice_summary_icd10
    name: "Voice AI Clinical Summary with ICD-10"
    hotkey: "CTRL+ALT+V"
    enabled: true
    description: "Summarize clinical note and suggest ICD-10 diagnosis code"

    input:
      source: selected_text
      validation:
        min_length: 10
        max_length: 5000

    connector: voice_ai

    request:
      template: |
        {
          "text": {{ input_text | tojson }},
          "language": "en",
          "include_icd10": true
        }
      timeout: 30
      method: POST

    response:
      mappings:
        summary: $.summary
        icd10_code: $.icd10.code
        icd10_label: $.icd10.label
        confidence: $.confidence

    validation:
      required_fields:
        - summary
        - icd10_code
      icd10_format: true

    output:
      - type: text
        target_field: DiagnosisText
        content: "{{ summary }}"
        mode: replace
        navigation: null

      - type: icd10
        target_field: DiagnosisCode
        content: "{{ icd10_code }}"
        label: "{{ icd10_label }}"
        mode: replace
        navigation: tab_3

    security:
      allowed_fields:
        - DiagnosisText
        - DiagnosisCode
        - ClinicalNotes
      require_confirmation: false
      max_response_size: 100000

  # Speech-to-text → DXCare observation field
  - workflow_id: speech_to_dxcare
    name: "Speech to DXCare Observation"
    hotkey: "CTRL+ALT+M"
    enabled: true
    description: "Clean up speech-to-text output and paste into the DXCare observation field"

    input:
      source: clipboard          # speech app auto-copies here; no Ctrl+C needed
      validation:
        min_length: 3
        max_length: 10000

    connector: text_processor

    request:
      template: |
        {
          "text": {{ input_text | tojson }}
        }
      timeout: 10
      method: POST

    response:
      mappings:
        processed_text: $.processed_text

    validation:
      required_fields:
        - processed_text

    output:
      - type: text
        target_field: ObservationField
        content: "{{ processed_text }}"
        mode: replace
        navigation: null
        # Coordinates of the large observation field in DXCare.
        # Adjust x,y to match your screen / window layout.
        click_before: "400,350"
        insert_method: paste

    security:
      allowed_fields:
        - ObservationField
      require_confirmation: false
      max_response_size: 50000

  # Example: Drug Interaction Checker (disabled for now)
  - workflow_id: drug_interaction_check
    name: "Drug Interaction Checker"
    hotkey: "CTRL+ALT+D"
    enabled: false
    description: "Check for drug interactions in medication list"

    input:
      source: selected_text
      validation:
        min_length: 3
        max_length: 1000

    connector: drug_checker

    request:
      template: |
        {
          "medications": {{ input_text | tojson }}
        }
      timeout: 20
      method: POST

    response:
      mappings:
        interactions: $.interactions
        severity: $.severity
        recommendations: $.recommendations

    validation:
      required_fields:
        - interactions

    output:
      - type: text
        target_field: ClinicalNotes
        content: "⚠️ Drug Interactions ({{ severity }}): {{ interactions }}"
        mode: append
        navigation: null

    security:
      allowed_fields:
        - ClinicalNotes
        - Warnings
      require_confirmation: true
